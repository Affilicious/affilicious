!function e(t,i,r){function a(o,s){if(!i[o]){if(!t[o]){var l="function"==typeof require&&require;if(!s&&l)return l(o,!0);if(n)return n(o,!0);var u=new Error("Cannot find module '"+o+"'");throw u.code="MODULE_NOT_FOUND",u}var c=i[o]={exports:{}};t[o][0].call(c.exports,function(e){var i=t[o][1][e];return a(i||e)},c,c.exports,e,t,i,r)}return i[o].exports}for(var n="function"==typeof require&&require,o=0;o<r.length;o++)a(r[o]);return a}({1:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}var a=e("./model/import"),n=r(a),o=e("./view/import"),s=r(o),l=new n.default;new s.default({model:l}).render()},{"./model/import":3,"./view/import":10}],2:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.Model.extend({defaults:{selectedShop:"amazon",newShopName:null,selectedAction:"new-product",mergeProductId:null,replaceProductId:null,status:"draft"}});i.default=r},{}],3:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=e("./search"),n=r(a),o=e("./config"),s=r(o),l=Backbone.Model.extend({defaults:{action:"aff_product_admin_amazon_import"},initialize:function(){this.search=new n.default,this.config=new s.default,this.search.on("aff:amazon-import:import-results-item",this.import,this)},import:function(e){var t=this,i={product:{name:e.attributes.name,type:e.attributes.type,shops:e.attributes.shops,custom_values:e.attributes.custom_values},config:this.config.attributes,form:this.search.form.attributes};jQuery.ajax({type:"POST",url:this._buildUrl(),data:i}).done(function(i){var r=((i||{}).data||{}).shop_template||null;r&&t.config.trigger("aff:amazon-import:config:add-shop",r),e.showSuccessMessage()}).fail(function(t){var i=((((t||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.showErrorMessage(i)})},_buildUrl:function(){return affAdminAmazonImportUrls.ajax+"?action="+this.get("action")}});i.default=l},{"./config":2,"./search":8}],4:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.Model.extend({defaults:{term:"",type:"keywords",category:"All",withVariants:"no",loading:!1,error:!1,errorMessage:null,providerConfigured:!1},submit:function(){this.set({loading:!0,error:!1,errorMessage:null}),this.trigger("aff:amazon-import:search:search-form:submit",this)},done:function(){this.set("loading",!1),this.trigger("aff:amazon-import:search:search-form:done",this)},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:search-form:error",this)}});i.default=r},{}],5:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.Model.extend({defaults:{enabled:!0,loading:!1,noResults:!1,error:!1,errorMessage:null},load:function(){this.set("loading",!0),this.trigger("aff:amazon-import:search:load-more:load",this)},done:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.set({loading:!1,enabled:e}),this.trigger("aff:amazon-import:search:load-more:done",this)},noResults:function(){this.set({loading:!1,noResults:!0}),this.trigger("aff:amazon-import:search:load-more:no-results",this)},error:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({enabled:!0,loading:!1,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:load-more:error",this)}});i.default=r},{}],6:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.Model.extend({defaults:{loading:!1,success:!1,successMessage:null,error:!1,errorMessage:null},import:function(){this.set("loading",!0),this.trigger("aff:amazon-import:search:results:item:import",this)},showSuccessMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,success:!0,successMessage:e}),this.trigger("aff:amazon-import:search:results:item:success",this)},showErrorMessage:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;this.set({loading:!1,error:!0,errorMessage:e}),this.trigger("aff:amazon-import:search:results:item:error",this)}});i.default=r},{}],7:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./search-results-item"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),n=Backbone.Collection.extend({model:a.default,initialize:function(){this.on("sync",this.initImportListeners,this)},parse:function(e){return e&&e.success?e.data:[]},importItem:function(e){this.trigger("aff:amazon-import:search:results:import-item",e)},initImportListeners:function(){this.forEach(this._initImportListener,this)},_initImportListener:function(e){e.on("aff:amazon-import:search:results:item:import",this.importItem,this)}});i.default=n},{"./search-results-item":6}],8:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=e("./search-form"),n=r(a),o=e("./search-load-more"),s=r(o),l=e("./search-results"),u=r(l),c=Backbone.Model.extend({defaults:{started:!1,action:"aff_product_admin_amazon_search",page:1},initialize:function(e){this.form=new n.default,this.results=new u.default,this.loadMore=new s.default,this.page=e&&e.page?e.page:1,this.results.on("aff:amazon-import:search:results:import-item",this.import,this),this.form.on("aff:amazon-import:search:search-form:submit",this.start,this),this.loadMore.on("aff:amazon-import:search:load-more:load",this.load,this)},start:function(){var e=this;null!==this.form.get("term")&&(this.set("page",1),this.results.url=this._buildUrl(),this.results.fetch().done(function(t){e.loadMore.set("enabled",e._isLoadMoreEnabled(t)),e.form.done()}).fail(function(t){var i=((((t||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.form.error(i),e.loadMore.set("enabled",!1)}).always(function(){e.set("started",!0)}))},load:function(){var e=this;this.set("page",this.get("page")+1),this.results.url=this._buildUrl(),this.results.fetch({remove:!1}).done(function(t){e.loadMore.done(e._isLoadMoreEnabled(t))}).fail(function(){var t=((((result||{}).responseJSON||{}).data||{})[0]||{}).message||null;e.loadMore.error(t)})},import:function(e){this.trigger("aff:amazon-import:import-results-item",e)},_buildUrl:function(){return affAdminAmazonImportUrls.ajax+"?action="+this.get("action")+"&term="+this.form.get("term")+"&type="+this.form.get("type")+"&category="+this.form.get("category")+"&with-variants="+this.form.get("withVariants")+"&page="+this.get("page")},_isLoadMoreEnabled:function(e){return e&&e.data&&e.data.length>0&&this.get("page")<5&&"keywords"===this.form.get("type")}});i.default=c},{"./search-form":4,"./search-load-more":5,"./search-results":7}],9:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.View.extend({el:"#aff-amazon-import-config",events:{'change input[name="shop"]':"changeShop",'change input[name="new-shop-name"]':"changeShop",'change input[name="action"]':"changeAction",'change input[name="merge-product-id"]':"changeAction",'change input[name="replace-product-id"]':"changeAction",'change input[name="status"]':"changeStatus"},initialize:function(){var e=jQuery("#aff-amazon-import-config-template").html();this.template=_.template(e),this.model.on("aff:amazon-import:config:add-shop",this.addShop,this)},render:function(){var e=this.template(this.model.attributes);return this.$el.html(e),this.$el.find(".aff-amazon-import-config-group-option-merge-product-id, .aff-amazon-import-config-group-option-replace-product-id").selectize({maxItems:1,valueField:"id",labelField:"name",searchField:"name",create:!1,load:function(e,t){if(!e.length)return t();jQuery.ajax({url:"/wp-json/wp/v2/aff-products/?search="+e,type:"GET",error:function(){t()},success:function(e){e=e.map(function(e){return{id:e.id,name:e.title.rendered}}),t(e)}})}}),this},addShop:function(e){this.$el.find('input[value="new-shop"]').parent().before('\n            <label class="aff-import-config-group-label" for="'+e.slug+'">\n                <input id="amazon" class="aff-import-config-group-option" name="shop" type="radio" value="'+e.slug+'">\n                '+e.name+"         \n            </label>\n        "),this.$el.find('input[name="shop"][value="'+e.slug+'"]').prop("checked",!0),this.$el.find('input[name="new-shop-name"]').selectize()[0].selectize.clear(!0)},changeShop:function(){var e=this.$el.find('input[name="shop"]:checked'),t=this.$el.find('input[name="new-shop-name"]');"new-shop"===e.val()?t.removeAttr("disabled"):t.attr("disabled","disabled"),this.model.set({selectedShop:e.val(),newShopName:t.val()})},changeAction:function(){var e=this.$el.find('input[name="action"]:checked'),t=this.$el.find('input[name="merge-product-id"]'),i=this.$el.find('input[name="replace-product-id"]'),r=t.selectize()[0].selectize,a=i.selectize()[0].selectize;"merge-product"===e.val()?r.enable():r.disable(),"replace-product"===e.val()?a.enable():a.disable(),this.model.set({selectedAction:e.val(),mergeProductId:t.val(),replaceProductId:i.val()})},changeStatus:function(){var e=this.$el.find('input[name="status"]:checked');this.model.set({status:e.val()})}});i.default=r},{}],10:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=e("./search"),n=r(a),o=e("./config"),s=r(o),l=Backbone.View.extend({el:"#aff-amazon-import",initialize:function(){this.search=new n.default({model:this.model.search}),this.config=new s.default({model:this.model.config})},render:function(){return this.search.render(),this.config.render(),this}});i.default=l},{"./config":9,"./search":15}],11:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.View.extend({el:"#aff-amazon-import-search-form",events:{change:"change",submit:"submit"},initialize:function(){var e=jQuery("#aff-amazon-import-search-form-template").html(),t=this.$el.data("provider-configured");this.template=_.template(e),this.model.set("providerConfigured",!0===t||"true"===t),this.model.on("change",this.render,this)},render:function(){this.$el.html(this.template(this.model.attributes));var e=this.$el.find('select[name="type"]'),t=this.$el.find('select[name="category"]'),i=this.$el.find('select[name="with-variants"]');return e.val(this.model.get("type")),t.val(this.model.get("category")),i.val(this.model.get("withVariants")),this},submit:function(e){e.preventDefault(),this.change(),this.model.submit()},change:function(){var e=this.$el.find('input[name="term"]'),t=this.$el.find('select[name="type"]'),i=this.$el.find('select[name="category"]'),r=this.$el.find('select[name="with-variants"]');this.model.set({term:e.val(),type:t.val(),category:i.val(),withVariants:r.val()})}});i.default=r},{}],12:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.View.extend({el:"#aff-amazon-import-search-load-more",events:{"click .aff-import-search-load-more-button":"load"},initialize:function(){var e=jQuery("#aff-amazon-import-search-load-more-template").html();this.template=_.template(e),this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},load:function(){this.model.load()}});i.default=r},{}],13:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=Backbone.View.extend({tagName:"div",className:"",events:{"click .aff-import-search-results-item-variants-show-all":"showAll","click .aff-import-search-results-item-actions-import":"import"},initialize:function(){var e=jQuery("#aff-amazon-import-search-results-item-template").html();this.template=_.template(e),this.model.on("change",this.render,this)},render:function(){return this.$el.html(this.template(this.model.attributes)),this},showAll:function(e){e.preventDefault(),this.$el.find(".aff-amazon-import-search-results-item-variants-show-all").hide(),this.$el.find(".aff-amazon-import-search-results-item-variants-item").show()},import:function(e){e.preventDefault(),this.model.import()}});i.default=r},{}],14:[function(e,t,i){"use strict";Object.defineProperty(i,"__esModule",{value:!0});var r=e("./search-results-item"),a=function(e){return e&&e.__esModule?e:{default:e}}(r),n=Backbone.View.extend({el:"#aff-amazon-import-search-results",initialize:function(e){var t=this;this.collection=e.collection,this.collection.bind("reset",function(){return t.render()}),this.collection.bind("add",function(){return t.render()}),this.collection.bind("remove",function(){return t.render()}),this.collection.bind("sync",function(){return t.render()})},render:function(){this._addAll()},_addAll:function(){this.$el.empty(),this.collection.forEach(this._addOne,this)},_addOne:function(e){var t=new a.default({model:e});this.$el.append(t.render().el)}});i.default=n},{"./search-results-item":13}],15:[function(e,t,i){"use strict";function r(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(i,"__esModule",{value:!0});var a=e("./search-form"),n=r(a),o=e("./search-load-more"),s=r(o),l=e("./search-results"),u=r(l),c=Backbone.View.extend({el:"#aff-amazon-import-search",initialize:function(){this.form=new n.default({model:this.model.form}),this.results=new u.default({collection:this.model.results}),this.loadMore=new s.default({model:this.model.loadMore}),this.model.on("change",this.render,this)},render:function(){return this.form.render(),this.results.render(),this.model.get("started")&&this.loadMore.render(),this}});i.default=c},{"./search-form":11,"./search-load-more":12,"./search-results":14}]},{},[1]);