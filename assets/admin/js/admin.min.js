"use strict";function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function e(e,t){for(var i=0;i<t.length;i++){var a=t[i];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(t,i,a){return i&&e(t.prototype,i),a&&e(t,a),t}}();jQuery(function(e){var t=window.carbon;if("undefined"==typeof t.fields)return!1;console.log(window.carbon.fields);var i=function(){function e(){_classCallCheck(this,e)}return _createClass(e,null,[{key:"getContainerView",value:function(){var e=null;return _.each(t.views,function(t){t.model&&t.model.attributes&&t.model.attributes.title==translations.container&&(e=t)}),e}},{key:"getVariantsView",value:function(){var e=null;return _.each(t.views,function(t){t.templateVariables&&"_affilicious_product_variants"==t.templateVariables.base_name&&(e=t)}),e}},{key:"getTypeView",value:function(){var e=null;return _.each(t.views,function(t){t.templateVariables&&"_affilicious_product_type"==t.templateVariables.base_name&&(e=t)}),e}},{key:"getEnabledAttributesView",value:function(){var e=null;return _.each(t.views,function(t){t.templateVariables&&"_affilicious_product_enabled_attributes"==t.templateVariables.base_name&&(e=t)}),e}},{key:"getVariantEnabledAttributesViews",value:function(){var e=[];return _.each(t.views,function(t){t.templateVariables&&"enabled_attributes"==t.templateVariables.base_name&&e.push(t)}),e}}]),e}(),a=function(){function e(){_classCallCheck(this,e);var t=i.getTypeView(),a=i.getVariantsView(),n=i.getEnabledAttributesView();t.$el.ready(this.toggleTabs),t.model.on("change:value",this.toggleTabs),a.$el.ready(this.toggleAttributes),a.model.on("change:value",this.toggleAttributes),n.$el.ready(this.toggleAttributes),n.model.on("change:value",this.toggleAttributes)}return _createClass(e,[{key:"toggleTabs",value:function(){var e=i.getContainerView(),t=i.getTypeView(),a=t.model.get("value"),n=e.$el.find('a[data-id="'+translations.variants.trim().toLowerCase()+'"]').parent(),l=e.$el.find('a[data-id="'+translations.shops.trim().toLowerCase()+'"]').parent();"complex"===a?(n.show(),l.hide()):(n.hide(),l.show())}},{key:"toggleAttributes",value:function(){var e=i.getEnabledAttributesView(),t=i.getVariantEnabledAttributesViews(),a=e.model.get("value"),n=!0,l=!1,r=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var c=o.value;c.model.set("value",a)}}catch(e){l=!0,r=e}finally{try{!n&&s.return&&s.return()}finally{if(l)throw r}}}}]),e}();window.affiliciousProduct=new a}),window.carbon=window.carbon||{},function(e){var t=window.carbon;return"undefined"!=typeof t.fields&&void(t.fields.View.ImageGallery=t.fields.View.Image.extend({events:_.extend({},t.fields.View.prototype.events,{"click .c2_open_media":"openMedia","click .carbon-image-remove":"removeImage"}),initialize:function(){t.fields.View.prototype.initialize.apply(this),this.on("field:beforeRender",this.loadDescriptionTemplate),this.on("field:rendered",this.sortableImages),this.listenTo(this.model,"change:images",this.updateInput),this.listenTo(this.model,"change:value",this.render)},sortableImages:function(){var t=this,i=this.$("ul.carbon-image-gallery");i.sortable({items:"li.carbon-image",cursor:"move",helper:"clone",scrollSensitivity:42,forcePlaceholderSize:!0,opacity:.75,forceHelperSize:!1,placeholder:"carbon-sortable-placeholder",update:function(){var a=[];i.find("li.carbon-image").each(function(){var t=e(this),i=t.attr("data-image-value"),n=t.find("img").attr("src");a.push({value:i,url:n})}),t.model.set("images",a)}})},openMedia:function(e){var t=this,i=this.model.get("type"),a=(this.model.get("images"),this.model.get("window_button_label")),n=this.model.get("window_label"),l=this.model.get("type_filter"),r=this.model.get("value_type"),o={};o[i]=wp.media.frames.crbMediaField=wp.media({title:n?n:crbl10n.title,library:{type:l},button:{text:a},multiple:!0});var s=o[i];s.on("select",function(){var e=s.state().get("selection").toJSON(),i=_.clone(t.model.get("images"));_.each(e,function(e){i.push({value:e[r],url:e.url})}),t.model.set("images",i)}),s.open(),e.preventDefault()},updateInput:function(e){console.log(e);var t=this.$("input.carbon-image-gallery-field"),i=e.get("images"),a=_.map(i,function(e){return e.value}),n=a.join();t.val(n).trigger("change")},removeImage:function(e){for(var t=this.$(e.currentTarget),i=t.parents("ul.carbon-image-gallery").children(),a=t.parents("li.carbon-image"),n=_.clone(this.model.get("images")),l=i.index(a),r=[],o=0;o<n.length;o++)o!=l&&r.push(n[o]);this.model.set("images",r)}}))}(jQuery),window.carbon=window.carbon||{},function(e){var t=window.carbon;return"undefined"!=typeof t.fields&&(t.fields.Model.Tags=t.fields.Model.extend({initialize:function(){t.fields.Model.prototype.initialize.apply(this)}}),void(t.fields.View.Tags=t.fields.View.extend({initialize:function(){t.fields.View.prototype.initialize.apply(this),this.on("field:rendered",this.initField)},initField:function(){var t=this;e(".aff-tags").tagsInput({width:"100%",height:"auto",defaultText:translations.addTag,interactive:!0,delimiter:";",minChars:1,maxChars:100,placeholderColor:"#666666",onChange:function(){t.model.set("value",e('input[name="'+t.templateVariables.name+'"]').val())}})}})))}(jQuery),jQuery(function(e){var t,i=e("#product_image_gallery"),a=e("#product_images_container").find("ul.product_images");e(".add_product_images").on("click","a",function(n){var l=e(this);return n.preventDefault(),t?void t.open():(t=wp.media.frames.product_gallery=wp.media({title:l.data("choose"),button:{text:l.data("update")},states:[new wp.media.controller.Library({title:l.data("choose"),filterable:"all",multiple:!0})]}),t.on("select",function(){var e=t.state().get("selection"),n=i.val();e.map(function(e){if(e=e.toJSON(),e.id){n=n?n+","+e.id:e.id;var t=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;a.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+t+'" /><ul class="actions"><li><a href="#" class="delete" title="'+l.data("delete")+'">'+l.data("text")+"</a></li></ul></li>")}}),i.val(n)}),void t.open())}),a.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),i.val(t)}}),e("#product_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";return e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),i.val(t),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1})});