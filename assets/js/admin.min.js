jQuery(function(e){function t(){var e=null;return _.each(l.views,function(t){t.model&&t.model.attributes&&t.model.attributes.title==translations.container&&(e=t)}),e}function a(){var e=null;return _.each(l.views,function(t){t.templateVariables&&"affilicious_product_variants"==t.templateVariables.base_name&&(e=t)}),e}function i(){var a=t(),i=e('select[name="_affilicious_product_type"]'),o=i.val(),r=a.$el.find('a[data-id="'+translations.variants.trim().toLowerCase()+'"]').parent(),l=a.$el.find('a[data-id="shops"]').parent();"complex"===o?(r.show(),l.hide()):(r.hide(),l.show())}function o(){var e=t(),i=a(),o=e.$el.find('select[name="_affilicious_product_attribute_group_key"]'),r=o.val();i.$actions.find("ul").remove(),i.$actions.find("a.button").data("group","none"!=r?"_"+r:"")}function r(e){var i=t(),r=a(),l=i.$el.find('select[name="_affilicious_product_attribute_group_key"]'),n=l.val();o(),console.log(r.model.get("temp_attribute_group_key")+" "+n),r.model.get("temp_attribute_group_key")!=n&&(r.model.set("temp_attribute_group_key",n),r.$groupsHolder.find(".carbon-row").remove(),r.$introRow.show(),r.groupsCollection.reset())}var l=window.carbon;if("undefined"==typeof l.fields)return!1;var n=t();n.$el.find('select[name="_affilicious_product_type"]').ready(i),n.$el.on('change select[name="_affilicious_product_type"]',i),n.$el.find('select[name="_affilicious_product_attribute_group_key"]').ready(o),n.$el.on('change select[name="_affilicious_product_attribute_group_key"]',r);var c,s=e("#product_image_gallery"),u=e("#product_images_container").find("ul.product_images");e(".add_product_images").on("click","a",function(t){var a=e(this);return t.preventDefault(),c?void c.open():(c=wp.media.frames.product_gallery=wp.media({title:a.data("choose"),button:{text:a.data("update")},states:[new wp.media.controller.Library({title:a.data("choose"),filterable:"all",multiple:!0})]}),c.on("select",function(){var e=c.state().get("selection"),t=s.val();e.map(function(e){if(e=e.toJSON(),e.id){t=t?t+","+e.id:e.id;var i=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;u.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+i+'" /><ul class="actions"><li><a href="#" class="delete" title="'+a.data("delete")+'">'+a.data("text")+"</a></li></ul></li>")}}),s.val(t)}),void c.open())}),u.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=e(this).attr("data-attachment_id");t=t+a+","}),s.val(t)}}),e("#product_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";return e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var a=e(this).attr("data-attachment_id");t=t+a+","}),s.val(t),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1})});