jQuery(function(e){function t(){var e=null;return _.each(r.views,function(t){t.templateVariables&&"affilicious_product_variants"==t.templateVariables.base_name&&(e=t)}),e}function i(){var t=e('select[name="_affilicious_product_type"]'),i=t.val(),a=e(".container-Affilicious"),o=t.children('option[value="variants"]').text().trim().toLowerCase(),r=a.find('a[data-id="'+o+'"]').parent(),l=a.find('a[data-id="shops"]').parent();"variants"===i?(r.show(),l.hide()):(r.hide(),l.show())}function a(){var e=r.views.Affilicious.$el.find('select[name="_affilicious_product_attribute_group_key"]'),i=e.val(),a=t();a.model.set("attribute_group_key",i),a.$actions.find("ul").remove(),a.$actions.find("a.button").data("group","none"!=i?"_"+i:"")}function o(e){var i=r.views.Affilicious.$el.find('select[name="_affilicious_product_attribute_group_key"]'),o=i.val(),l=t();a(),l.model.get("attribute_group_key")!=o&&(l.model.set("attribute_group_key",o),l.$groupsHolder.find(".carbon-row").remove(),l.$introRow.show(),l.groupsCollection.reset())}var r=window.carbon;if("undefined"==typeof r.fields)return!1;r.views.Affilicious.$el.children('select[name="_affilicious_product_type"]').ready(i),r.views.Affilicious.$el.on('change select[name="_affilicious_product_type"]',i),r.views.Affilicious.$el.children('select[name="_affilicious_product_attribute_group_key"]').ready(a),r.views.Affilicious.$el.on('change select[name="_affilicious_product_attribute_group_key"]',o);var l,n=e("#product_image_gallery"),c=e("#product_images_container").find("ul.product_images");e(".add_product_images").on("click","a",function(t){var i=e(this);return t.preventDefault(),l?void l.open():(l=wp.media.frames.product_gallery=wp.media({title:i.data("choose"),button:{text:i.data("update")},states:[new wp.media.controller.Library({title:i.data("choose"),filterable:"all",multiple:!0})]}),l.on("select",function(){var e=l.state().get("selection"),t=n.val();e.map(function(e){if(e=e.toJSON(),e.id){t=t?t+","+e.id:e.id;var a=e.sizes&&e.sizes.thumbnail?e.sizes.thumbnail.url:e.url;c.append('<li class="image" data-attachment_id="'+e.id+'"><img src="'+a+'" /><ul class="actions"><li><a href="#" class="delete" title="'+i.data("delete")+'">'+i.data("text")+"</a></li></ul></li>")}}),n.val(t)}),void l.open())}),c.sortable({items:"li.image",cursor:"move",scrollSensitivity:40,forcePlaceholderSize:!0,forceHelperSize:!1,helper:"clone",opacity:.65,placeholder:"wc-metabox-sortable-placeholder",start:function(e,t){t.item.css("background-color","#f6f6f6")},stop:function(e,t){t.item.removeAttr("style")},update:function(){var t="";e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),n.val(t)}}),e("#product_images_container").on("click","a.delete",function(){e(this).closest("li.image").remove();var t="";return e("#product_images_container").find("ul li.image").css("cursor","default").each(function(){var i=e(this).attr("data-attachment_id");t=t+i+","}),n.val(t),e("#tiptip_holder").removeAttr("style"),e("#tiptip_arrow").removeAttr("style"),!1})});